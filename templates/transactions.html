{% extends 'base.html' %}
{% block title %}Transactions{% endblock %}
{% block content %}
<div class="max-w-7xl mx-auto">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold text-white">Transactions</h1>
    <div>
      <a href="{% url 'transactions-export' %}?type={{ type_filter }}&status={{ status_filter }}&start={{ start }}&end={{ end }}" class="inline-flex items-center px-4 py-2 rounded-md bg-gray-800 text-gray-200 hover:bg-gray-700">Export CSV</a>
    </div>
  </div>

  <!-- Filters -->
  <form method="get" class="bg-gray-900 border border-gray-800 rounded-lg p-4 mb-6 grid grid-cols-1 md:grid-cols-6 gap-4">
    <div>
      <label class="block text-sm text-gray-400 mb-1">Type</label>
      <select name="type" class="w-full bg-gray-800 border border-gray-700 text-gray-200 rounded px-3 py-2">
        <option value="all" {% if type_filter == 'all' %}selected{% endif %}>All</option>
        <option value="deposit" {% if type_filter == 'deposit' %}selected{% endif %}>Deposit</option>
        <option value="withdrawal" {% if type_filter == 'withdrawal' %}selected{% endif %}>Withdrawal</option>
        <option value="investment" {% if type_filter == 'investment' %}selected{% endif %}>Investment</option>
        <option value="referral" {% if type_filter == 'referral' %}selected{% endif %}>Referral</option>
      </select>
    </div>
    <div>
      <label class="block text-sm text-gray-400 mb-1">Status</label>
      <input name="status" value="{{ status_filter }}" placeholder="e.g. approved, pending" class="w-full bg-gray-800 border border-gray-700 text-gray-200 rounded px-3 py-2" />
    </div>
    <div>
      <label class="block text-sm text-gray-400 mb-1">Start date</label>
      <input type="date" name="start" value="{{ start }}" class="w-full bg-gray-800 border border-gray-700 text-gray-200 rounded px-3 py-2" />
    </div>
    <div>
      <label class="block text-sm text-gray-400 mb-1">End date</label>
      <input type="date" name="end" value="{{ end }}" class="w-full bg-gray-800 border border-gray-700 text-gray-200 rounded px-3 py-2" />
    </div>
    <div>
      <label class="block text-sm text-gray-400 mb-1">Per page</label>
      <select name="page_size" class="w-full bg-gray-800 border border-gray-700 text-gray-200 rounded px-3 py-2">
        {% for size in 10|make_list %}{% endfor %}
        <option value="20" {% if page_size == 20 %}selected{% endif %}>20</option>
        <option value="50" {% if page_size == 50 %}selected{% endif %}>50</option>
        <option value="100" {% if page_size == 100 %}selected{% endif %}>100</option>
      </select>
    </div>
    <div class="flex items-end"><button class="px-4 py-2 bg-green-700 hover:bg-green-600 text-white rounded">Apply</button></div>
  </form>

  <!-- Table -->
  <div class="bg-gray-900 rounded-lg shadow-2xl p-6 border border-gray-800">
    {% if page_obj.object_list %}
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-800">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Type</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Details</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Amount</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-700">
          {% for t in page_obj.object_list %}
          <tr class="hover:bg-gray-800 transition">
            <td class="px-6 py-4 whitespace-nowrap text-gray-400">{{ t.created_at|date:"M d, Y h:i A" }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-200">{{ t.type }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-400">{{ t.details }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-gray-200">{{ t.amount|floatformat:2 }}{% if t.currency %} <span class="text-gray-400">{{ t.currency }}</span>{% endif %}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              {% with s=t.status|lower %}
              <span class="px-2 py-1 rounded-full text-sm
                {% if 'paid' in s or 'approved' in s or 'completed' in s %} bg-green-900 text-green-200
                {% elif 'pending' in s or 'processing' in s or 'active' in s %} bg-yellow-900 text-yellow-200
                {% elif 'rejected' in s or 'cancel' in s %} bg-red-900 text-red-200
                {% else %} bg-gray-800 text-gray-200 {% endif %}">
                {{ t.status }}
              </span>
              {% endwith %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="mt-4 flex items-center justify-between text-gray-300">
      <div>Page {{ page_obj.number }} of {{ paginator.num_pages }}</div>
      <div class="space-x-2">
        {% if page_obj.has_previous %}
          <a class="px-3 py-1 bg-gray-800 rounded hover:bg-gray-700" href="?type={{ type_filter }}&status={{ status_filter }}&start={{ start }}&end={{ end }}&page={{ page_obj.previous_page_number }}&page_size={{ page_size }}">Previous</a>
        {% endif %}
        {% if page_obj.has_next %}
          <a class="px-3 py-1 bg-gray-800 rounded hover:bg-gray-700" href="?type={{ type_filter }}&status={{ status_filter }}&start={{ start }}&end={{ end }}&page={{ page_obj.next_page_number }}&page_size={{ page_size }}">Next</a>
        {% endif %}
      </div>
    </div>
    {% else %}
      <p class="text-gray-400">No transactions match your filters.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
